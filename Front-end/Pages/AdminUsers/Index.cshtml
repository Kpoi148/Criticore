@page
@model Front_end.Pages.AdminUsers.IndexModel
@{
    ViewData["Title"] = "Criticore - User Management";
    @* Assuming a layout is used, even if not explicitly specified in the original snippet, for styling *@
    Layout = "~/Pages/Shared/_HomepageLayout.cshtml";
}

<div class="container py-5">
    @* Header *@
    <h1 class="mb-4 display-5 fw-bold text-dark">
        <i class="bi bi-people-fill me-2"></i>User Management
    </h1>

    @* --- Optional: Success/Error Message Area --- *@
    @if (!string.IsNullOrEmpty(Model.TempData["SuccessMessage"] as string))
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @Model.TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @* --- End Optional Message --- *@

    @* User List Table *@
    <div class="table-responsive shadow-lg rounded-3 overflow-hidden">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-primary text-white">
                <tr>
                    <th scope="col" class="py-3">User ID</th>
                    <th scope="col" class="py-3">Full Name</th>
                    <th scope="col" class="py-3">Email</th>
                    <th scope="col" class="py-3 text-center">Role</th>
                    <th scope="col" class="py-3 text-center">Status</th>
                    <th scope="col" class="py-3 text-center" style="min-width: 300px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model.Users)
                {
                    <tr data-user-id="@user.UserId">
                        <td class="fw-bold text-primary">@user.UserId</td>
                        <td>@user.FullName</td>
                        <td>@user.Email</td>

                        @* Role Display with Badges *@
                        <td class="text-center">
                            @{
                                var roleClass = user.Role == "Admin" ? "bg-danger" : (user.Role == "Teacher" ? "bg-warning text-dark" : "bg-info");
                            }
                            <span class="badge @roleClass fw-semibold role-badge">@user.Role</span>
                        </td>

                        @* Status Display with Badges *@
                        <td class="text-center">
                            @{
                                var statusClass = user.Status == "Active" ? "bg-success" : "bg-secondary";
                                var statusText = user.Status == "Active" ? "Active" : "Banned";
                            }
                            <span class="badge @statusClass fw-semibold status-badge">@statusText</span>
                        </td>

                        @* Actions *@
                        <td class="text-center">
                            @* Ban/Unban *@
                            @if (user.Status != "Banned")
                            {
                                <form method="post" asp-page-handler="Ban" asp-route-id="@user.UserId" style="display:inline;" onsubmit="return confirm('Are you sure you want to ban @user.FullName?');">
                                    <button type="submit" class="btn btn-outline-danger btn-sm me-1">
                                        <i class="bi bi-person-slash"></i> Ban
                                    </button>
                                </form>
                            }
                            else
                            {
                                <form method="post" asp-page-handler="Unban" asp-route-id="@user.UserId" style="display:inline;">
                                    <button type="submit" class="btn btn-outline-success btn-sm me-1">
                                        <i class="bi bi-person-check"></i> Unban
                                    </button>
                                </form>
                            }

                            @* Role Change: Set User (roleType=1) *@
                            <form method="post" asp-page-handler="ChangeRole" asp-route-id="@user.UserId" asp-route-roleType="1" style="display:inline;" onsubmit="return confirm('Change @user.FullName to User role?');">
                                <button type="submit" class="btn btn-outline-info btn-sm me-1" @(user.Role == "User" ? "disabled" : "") title="Set Role to User">
                                    <i class="bi bi-person"></i> Set User
                                </button>
                            </form>

                            @* Role Change: Set Teacher (roleType=2) *@
                            <form method="post" asp-page-handler="ChangeRole" asp-route-id="@user.UserId" asp-route-roleType="2" style="display:inline;" onsubmit="return confirm('Change @user.FullName to Teacher role?');">
                                <button type="submit" class="btn btn-outline-warning btn-sm" @(user.Role == "Teacher" ? "disabled" : "") title="Set Role to Teacher">
                                    <i class="bi bi-mortarboard"></i> Set Teacher
                                </button>
                            </form>
                        </td>
                    </tr>
                }
                @if (!Model.Users.Any())
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">No users found.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
@section Scripts {
    <script src="~/js/userHub.js"></script>
}
